var gdjs;(function(o){let D;(function(x){let k;(function(t){const N=e=>typeof e.eventName=="string"&&typeof e.data=="string";class C{constructor(n,s){this.data="";this.sender="";this.data=n,this.sender=s}}class T{constructor(){this.data=[];this.dataloss=!1}isTriggered(){return this.data.length>0}pushData(n){this.dataloss&&this.data.length>0?this.data[0]=n:this.data.push(n)}popData(){this.data.shift()}getData(){return this.data.length===0?"":this.data[0].data}getSender(){return this.data.length===0?"":this.data[0].sender}}let g=null,u={debug:1},r=null;const a={},i={};let b=!1,h=!1,E="";const l=[],c=[],v=()=>{r===null&&(g!==null?r=new Peer(g,u):r=new Peer(u),r.on("open",()=>{b=!0}),r.on("error",e=>{h=!0,E=e}),r.on("connection",e=>{e.on("open",()=>{P(e),c.push(e.peer)})}),r.on("close",()=>{r=null,v()}),r.on("disconnected",r.reconnect))},P=e=>{a[e.peer]=e,e.on("data",n=>{N(n)&&t.getEvent(n.eventName).pushData(new C(n.data,e.peer))}),e.on("error",()=>{f(e.peer)}),e.on("close",()=>{f(e.peer)}),function n(){e.peerConnection.connectionState==="failed"||e.peerConnection.connectionState==="disconnected"||e.peerConnection.connectionState==="closed"?f(e.peer):setTimeout(n,1e3)}()},f=e=>{!a.hasOwnProperty(e)||(l.push(e),delete a[e])};t.getEvent=e=>(i.hasOwnProperty(e)||(i[e]=new T),i[e]),t.connect=e=>{if(r===null)return;const n=r.connect(e);n.on("open",()=>{P(n)})},t.onEvent=(e,n)=>{const s=t.getEvent(e);return s.dataloss=n,s.isTriggered()},t.sendDataTo=(e,n,s)=>{a[e]&&a[e].send({eventName:n,data:s})},t.sendDataToAll=(e,n)=>{for(const s in a)t.sendDataTo(s,e,n)},t.sendVariableTo=(e,n,s)=>{t.sendDataTo(e,n,o.evtTools.network.variableStructureToJSON(s))},t.sendVariableToAll=(e,n)=>{t.sendDataToAll(e,o.evtTools.network.variableStructureToJSON(n))},t.getEventData=e=>t.getEvent(e).getData(),t.getEventSender=e=>t.getEvent(e).getSender(),t.getEventVariable=(e,n)=>{o.evtTools.network.jsonToVariableStructure(t.getEventData(e),n)},t.useCustomBrokerServer=(e,n,s,w,V)=>{u={debug:1,host:e,port:n,path:s,secure:V,key:w.length===0?"peerjs":w},v()},t.useDefaultBrokerServer=v,t.overrideId=e=>{g=e},t.getCurrentId=()=>r==null?"":r.id||"",t.isReady=()=>b,t.onError=()=>{const e=h;return h=!1,e},t.getLastError=()=>E,t.onDisconnect=()=>l.length>0,t.getDisconnectedPeer=()=>l[0]||"",t.onConnection=()=>c.length>0,t.getConnectedPeer=()=>c[0]||"",o.callbacksRuntimeScenePostEvents.push(()=>{for(const e in i)!i.hasOwnProperty(e)||i[e].popData();l.length>0&&l.shift(),c.length>0&&c.shift()})})(k=x.p2p||(x.p2p={}))})(D=o.evtTools||(o.evtTools={}))})(gdjs||(gdjs={}));
//# sourceMappingURL=B_p2ptools.js.map
