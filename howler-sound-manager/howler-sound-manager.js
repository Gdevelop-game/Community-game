var gdjs;(function(p){const f={preload:!0,onplayerror:(w,e)=>console.error("Can't play an audio file: ",e),onloaderror:(w,e)=>console.error("Error while loading an audio file: ",e)};class m{constructor(e){this._id=null;this._oncePlay=[];this._onPlay=[];this._howl=e}isLoaded(){return this._howl.state()==="loaded"}play(){if(this.isLoaded()){const e=this._howl.play(this._id===null?"__default":this._id);this._id=e,this._onPlay.forEach(s=>{this.on("play",s),s(e)}),this._oncePlay.forEach(s=>s(e)),this._onPlay=[],this._oncePlay=[]}else this._howl.once("load",()=>this.play());return this}pause(){return this._id!==null&&this._howl.pause(this._id),this}stop(){return this._id!==null&&this._howl.stop(this._id),this}playing(){return(this._id!==null?this._howl.playing(this._id):!0)||!this.isLoaded()}paused(){return!this.playing()}stopped(){return this.paused()&&this.getSeek()===0}getRate(){return this._id===null?0:this._howl.rate(this._id)}setRate(e){return this._id!==null&&(e=p.HowlerSoundManager.clampRate(e),this._howl.rate(e,this._id)),this}getLoop(){return this._id===null?!1:this._howl.loop(this._id)}setLoop(e){return this._id!==null&&this._howl.loop(e,this._id),this}getVolume(){return this._id===null?100:this._howl.volume(this._id)}setVolume(e){return this._id!==null&&this._howl.volume(e,this._id),this}getMute(){return this._id===null?!1:this._howl.mute(this._id)}setMute(e){return this._id!==null&&this._howl.mute(e,this._id),this}getSeek(){return this._id===null?0:this._howl.seek(this._id)}setSeek(e){return this._id!==null&&this._howl.seek(e,this._id),this}getSpatialPosition(e){return this._id===null?0:this._howl.pos(this._id)[e==="x"?0:e==="y"?1:2]}setSpatialPosition(e,s,t){return this._id!==null&&this._howl.pos(e,s,t,this._id),this}fade(e,s,t){return this._id!==null&&this._howl.fade(e,s,t,this._id),this}on(e,s){return e==="play"?this._id===null?this._onPlay.push(s):this._howl.on(e,s,this._id):this._id===null?this.once("play",()=>this.on(e,s)):this._howl.on(e,s,this._id),this}once(e,s){return e==="play"?this._id===null?this._oncePlay.push(s):this.playing()?s(this._id):this._howl.once(e,s,this._id):this._id===null?this.once("play",()=>this.once(e,s)):this._howl.once(e,s,this._id),this}off(e,s){return this._id!==null&&this._howl.off(e,s,this._id),this}}p.HowlerSound=m;class g{constructor(e){this._loadedMusics={};this._loadedSounds={};this._availableResources={};this._globalVolume=100;this._sounds={};this._musics={};this._freeSounds=[];this._freeMusics=[];this._pausedSounds=[];this._paused=!1;this._resources=e;const s=this;document.addEventListener("deviceready",function(){document.addEventListener("pause",function(){const t=s._freeSounds.concat(s._freeMusics);for(let o in s._sounds)s._sounds.hasOwnProperty(o)&&t.push(s._sounds[o]);for(let o in s._musics)s._musics.hasOwnProperty(o)&&t.push(s._musics[o]);for(let o=0;o<t.length;o++){const i=t[o];!i.paused()&&!i.stopped()&&(i.pause(),s._pausedSounds.push(i))}s._paused=!0},!1),document.addEventListener("resume",function(){for(let t=0;t<s._pausedSounds.length;t++){const o=s._pausedSounds[t];o.stopped()||o.play()}s._pausedSounds.length=0,s._paused=!1},!1)})}setResources(e){this._resources=e}static clampRate(e){return e>4?4:e<.5?.5:e}_getFileFromSoundName(e){return this._availableResources.hasOwnProperty(e)&&this._availableResources[e].file?this._availableResources[e].file:e}_storeSoundInArray(e,s){for(var t=0,o=e.length;t<o;++t)if(e[t]!==null&&e[t].stopped())return e[t]=s,s;return e.push(s),s}createHowlerSound(e,s){const t=this._getFileFromSoundName(e),o=s?this._loadedMusics:this._loadedSounds;return o.hasOwnProperty(t)||(o[t]=new Howl(Object.assign({src:[t],html5:s},f))),new p.HowlerSound(o[t])}loadAudio(e,s){const t=this._getFileFromSoundName(e),o=s?this._loadedMusics:this._loadedSounds;o.hasOwnProperty(t)||(o[t]=new Howl(Object.assign({src:[t],html5:s},f)))}unloadAudio(e,s){const t=this._getFileFromSoundName(e),o=s?this._loadedMusics:this._loadedSounds;if(!o[t])return;const i=o[t];function l(u){for(let r in u)u[r]&&u[r]._howl===i&&(u[r].stop(),delete u[r])}l(this._freeMusics),l(this._freeSounds),l(Object.values(this._musics)),l(Object.values(this._sounds)),l(this._pausedSounds),o[t].unload(),delete o[t]}unloadAll(){Howler.unload(),this._freeSounds.length=0,this._freeMusics.length=0,this._sounds={},this._musics={},this._pausedSounds.length=0,this._loadedMusics={},this._loadedSounds={}}playSound(e,s,t,o){var i=this.createHowlerSound(e,!1);this._storeSoundInArray(this._freeSounds,i).play(),i.once("play",()=>{i.setLoop(s).setVolume(t/100).setRate(o),this._paused&&(i.pause(),this._pausedSounds.push(i))})}playSoundOnChannel(e,s,t,o,i){this._sounds[s]&&this._sounds[s].stop();var l=this.createHowlerSound(e,!1).play();this._sounds[s]=l,l.once("play",()=>{l.setLoop(t).setVolume(o/100).setRate(i),this._paused&&(l.pause(),this._pausedSounds.push(l))})}getSoundOnChannel(e){return this._sounds[e]}playMusic(e,s,t,o){var i=this.createHowlerSound(e,!0);this._storeSoundInArray(this._freeMusics,i).play(),i.once("play",()=>{i.setLoop(s).setVolume(t/100).setRate(o),this._paused&&(i.pause(),this._pausedSounds.push(i))})}playMusicOnChannel(e,s,t,o,i){this._musics[s]&&this._musics[s].stop();const l=this.createHowlerSound(e,!0).play();this._musics[s]=l,l.once("play",()=>{l.setLoop(t).setVolume(o/100).setRate(i),this._paused&&(l.pause(),this._pausedSounds.push(l))})}getMusicOnChannel(e){return this._musics[e]}setGlobalVolume(e){this._globalVolume=e,this._globalVolume>100&&(this._globalVolume=100),this._globalVolume<0&&(this._globalVolume=0),Howler.volume(this._globalVolume/100)}getGlobalVolume(){return this._globalVolume}clearAll(){Howler.stop(),this._freeSounds.length=0,this._freeMusics.length=0,this._sounds={},this._musics={},this._pausedSounds.length=0}preloadAudio(e,s,t){t=t||this._resources;const o={};for(var i=0,l=t.length;i<l;++i){let n=t[i];if(n.file&&n.kind==="audio"){if(this._availableResources[n.name])continue;this._availableResources[n.name]=n,o[n.file]=(o[n.file]||[]).concat(n)}}const u=Object.keys(o).length;if(u===0)return s(u);let r=0;const d=(n,a)=>{if(a&&console.error("There was an error while loading an audio file:",a),r++,r===u)return s(u);e(r,u)},_=(n,a,h)=>{const c=h?this._loadedMusics:this._loadedSounds;c[n]=new Howl(Object.assign({},f,{src:[n],onload:a,onloaderror:a,html5:h}))};for(let n in o)if(o.hasOwnProperty(n)){const a=o[n][0];if(!a.preloadAsSound&&!a.preloadAsMusic)d();else if(a.preloadAsSound&&a.preloadAsMusic){let h=!1;const c=(S,y)=>{if(!h){h=!0;return}d(S,y)};_(n,c,!0),_(n,c,!1)}else a.preloadAsSound?_(n,d,!1):a.preloadAsMusic&&_(n,d,!0)}}}p.HowlerSoundManager=g,p.SoundManager=g})(gdjs||(gdjs={}));
//# sourceMappingURL=howler-sound-manager.js.map
